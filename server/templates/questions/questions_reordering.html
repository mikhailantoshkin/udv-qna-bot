{% extends "base.html" %}

{% block content %}
<div class="container">
  <div class="row">
    <div class="col">
      <div>
        <form hx-encoding='multipart/form-data' hx-post="/questions/new" hx-swap="afterbegin"
          hx-target="#categories-table" id="createForm">
          <div class="mb-3">
            <label for="question-text">Question:</label>
            <input type="text" class="form-control" id="question-question" name="question" disabled>
          </div>
          <div class="mb-3">
            <label for="question-text">Answer:</label>
            <input type="text" class="form-control" id="question-answer" name="answer" disabled>
          </div>
          <div class="mb-3">
            <label for="question-hidden">Hidden:</label>
            <input type="checkbox" id="question-hidden" name="hidden" disabled>
          </div>
          <div class="mb-3">
            <label for="question-attachments">Attachment:</label>
            <input type="file" id="question-attachments" name="attachment" disabled>
          </div>
          <div class="modal-footer">
            <button type="submit">Create</button>
          </div>
        </form>
      </div>
      <div id="mega-div">
        <select id="category-select-filter" name="category">
          <option>All</option>
          {% for category in categories.as_slice() -%}
          <option value="{{ category.id }}" {% if category.id==selected %}selected{% endif %}>{{category.name}}
          </option>
          {% endfor %}
        </select>
        <table>
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">name</th>
              <th scope="col">hidden</th>
              <th scope="col"><button id="order-save" hx-post="/questions/order" hx-ext='json-enc'
                  hx-include="#mega-div" hx-target="body">Save</button>
                <button hx-get="/questions" hx-include="#category-select-filter" hx-target="body">Cancel</button>
              </th>
            </tr>
          </thead>
          <tbody class="sortable">
            {% for question in questions.as_slice() -%}
            <tr>
              <td><input type='hidden' name='row_id' value='{{question.id}}' />{{question.id}}</td>
              <td>
                {% match question.category %}
                {% when Some with (category) %}
                {{category}}
                {% when None %}
                {% endmatch %} </td>
              <td>{{question.question}}</td>
              <td>{{question.answer}}</td>
              <td>{{question.hidden}}</td>
              <td><button class="uk-button uk-button-primary">Open Modal</button></td>
              <td></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<script>
  htmx.on('#order-save', 'htmx:configRequest', category_remover);
</script>
{% endblock content %}